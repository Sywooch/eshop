$(document).ready(function(){function a(a){a.count&&$("#cart-count").text(a.count),a.sum&&$("#cart-sum").text(a.sum)}function b(a){return parseInt(a.attr("id").replace(/[^\d]+/,""))}var c="snippets/process.php";$('button[type="button"]').click(function(a){a.preventDefault()}),$("#promo-code-wrapper button").click(function(){$this=$(this).prev(),$("#cart-item-promocode").next().remove(),$.post(c,{action:"a",promocode:$.trim($("#cart-item-promocode").val())},function(a,b){"success"==b&&1==a.status?($this.removeClass("has-error").addClass("has-success"),$("#cart-item-promocode").after('<span class="glyphicon glyphicon-ok form-control-feedback"></span>')):($this.removeClass("has-success").addClass("has-error"),$("#cart-item-promocode").after('<span class="glyphicon glyphicon-remove form-control-feedback"></span>'))},"json")}),$("#push-to-cart").click(function(){var b=$.trim($("#cart-item-amount").val());$.post(c,{action:"b",item_id:parseInt($("#item_id").val()),size:$.trim($("#cart-item-size option:selected").val()),amount:b,inscription:$.trim($("#cart-item-inscription").val()),printpromolink:$("#cart-item-printpromolink").prop("checked")+0,promocode:$.trim($("#cart-item-promocode").val())},function(c,d){"success"==d&&1==c.status?($("#modalCart .alert-success").html('Вы добавили футболок: <span class="amount badge">'+b+"</span>."),$("#modalCart .var-error").hide(),$("#modalCart .var-success").show(),a(c)):("size"==c.reason?$("#modalCart .alert-danger").html("Вы не выбрали размер."):"amount"==c.reason&&$("#modalCart .alert-danger").html("Вы не указали количество."),$("#modalCart .var-success").hide(),$("#modalCart .var-error").show()),$("#modalCart").modal()},"json")}),$('button[id^="item-id-"]').click(function(){$.post(c,{action:"c",item_id:b($(this))},function(b,c){"success"==c&&1==b.status?($("#modalCart .alert-success").html('Вы положили <span class="badge">1</span> футболку в Вашу корзину.'),$("#modalCart .var-error").hide(),$("#modalCart .var-success").show(),a(b)):($("#modalCart .var-success").hide(),$("#modalCart .var-error").show()),$("#modalCart").modal()},"json")}),$("#blueimp-gallery").on("slide",function(){$(".add-to-cart").unbind().click(function(){var b=$(this).parents(".modal-content").find("img").attr("src").match(/\?(\d+)$/)[1];$.post(c,{action:"c",item_id:b},function(b,c){"success"==c&&1==b.status?($("#modalCart .alert-success").html('Вы положили <span class="badge">1</span> футболку в Вашу корзину.'),$("#modalCart .var-error").hide(),$("#modalCart .var-success").show(),a(b)):($("#modalCart .var-success").hide(),$("#modalCart .var-error").show()),$("#modalCart").css({"z-index":$("#blueimp-gallery").css("z-index")+1}),$("#modalCart").modal()},"json")})}),$('button[id^="cart-id-"]').click(function(){$this=$(this),$.post(c,{action:"d",id:b($(this))},function(b,c){"success"==c&&1==b.status&&(b.count>0?($this.parents("tr:first").remove(),a(b),$("#cart-total").text(b.total)):($("#cart-wrapper").remove(),$(".alert-info").show()),b.count<5&&$("#back-to-top").parent().remove())},"json")}),$('button[id^="cart-idu-"]').click(function(){var d=b($(this));$.post(c,{action:"e",id:d,size:$.trim($("#cart-item-size-"+d+" option:selected").val()),amount:$.trim($("#cart-item-amount-"+d).val()),printpromolink:$("#cart-item-printpromolink-"+d).prop("checked")+0},function(b,c){"success"==c&&1==b.status&&($("#cart-item-price-"+d).find("span").remove(),$("#cart-item-printpromolink-"+d).prop("checked")&&$("#cart-item-price-"+d).append('<span class="small label label-default">-10%</span>'),a(b),$("#cart-item-price-amount-"+d).text(b.priceamount),$("#cart-total").text(b.total))},"json")}),$('td[id^="cart-inscription-"] a').click(function(a){a.preventDefault();var d=b($(this).parents("td:first"));$("#modalCartItem").modal().one("shown.bs.modal",function(){$("textarea",$(this)).val($.trim($("#cart-inscription-"+d+" div:first").text()))}).one("hide.bs.modal",function(){var a=$.trim($("textarea",$(this)).val());$.post(c,{action:"f",id:d,inscription:a},function(b,c){"success"==c&&1==b.status&&$("#cart-inscription-"+d+" div:first").text(a)},"json")})})});